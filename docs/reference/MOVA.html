<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Conduct MOVA. The training was performed in a random forest, and the evaluation was performed using the Stratified 5-fold cross validation method, which was repeated five more times to reduce the variability from one execution to another. The ROC curve was used to evaluate the results. In addition, final predictions were calculated for possible nonsynonymous variants.
"><title>Derivation of predictions and ROC curves by MOVA
 — MOVA • MOVA</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Derivation of predictions and ROC curves by MOVA
 — MOVA"><meta property="og:description" content="Conduct MOVA. The training was performed in a random forest, and the evaluation was performed using the Stratified 5-fold cross validation method, which was repeated five more times to reduce the variability from one execution to another. The ROC curve was used to evaluate the results. In addition, final predictions were calculated for possible nonsynonymous variants.
"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MOVA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Derivation of predictions and ROC curves by MOVA
<!-- %%  ~~function to do ... ~~ --></h1>
      
      <div class="d-none name"><code>MOVA.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Conduct MOVA. The training was performed in a random forest, and the evaluation was performed using the Stratified 5-fold cross validation method, which was repeated five more times to reduce the variability from one execution to another. The ROC curve was used to evaluate the results. In addition, final predictions were calculated for possible nonsynonymous variants.
<!-- %%  ~~ A concise (1-5 lines) description of what the function does. ~~ --></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">MOVA</span><span class="op">(</span><span class="va">fasta_file_name</span>, <span class="va">protein_name</span>, <span class="va">pdb_file_name</span>, <span class="va">final_predict_input_file</span>, <span class="va">variant_file</span>, phenotype <span class="op">=</span> <span class="st">"Target"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>fasta_file_name</dt>
<dd><p>fasta file that records the amino acid sequence information of the target protein. The first line should describe &gt;Protein, and the amino acid sequence should begin on the second line.
<!-- %%     ~~Describe \code{fasta_file_name} here~~ --></p></dd>

  <dt>protein_name</dt>
<dd><p>Name of target protein/gene. Used to name the file to be exported.
<!-- %%     ~~Describe \code{protein_name} here~~ --></p></dd>

  <dt>pdb_file_name</dt>
<dd><p>AlphaFold2 prediction results pdb file for the target protein. We use data from the AlphaFold2 Protein Structure Database. (https://alphafold.ebi.ac.uk/)
<!-- %%     ~~Describe \code{pdb_file_name} here~~ --></p></dd>

  <dt>final_predict_input_file</dt>
<dd><p>File output by the Edit_final_variant_file function
<!-- %%     ~~Describe \code{final_predict_input_file} here~~ --></p></dd>

  <dt>variant_file</dt>
<dd><p>export_file_name1 by the Edit_polyphen_data function
<!-- %%     ~~Describe \code{variant_file} here~~ --></p></dd>

  <dt>phenotype</dt>
<dd><p>Specify "Target" if you want the positive variant to be the Target variant only, or "Pathogenic" if you want to include the Pathogenic variant as well. The default is "Target".
<!-- %%     ~~Describe \code{phenotype} here~~ --></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Draw ROC curve for MOVA (red). MOVA is evaluated using the Stratified 5-fold cross validation method, and the model is repeated five more times. The average of the predicted values (5F-MV value: 5-fold MOVA value) is added to the "MOVA_predict" column of the "gene name_Target or Pathogenic_predict.csv" file. The final MOVA predicted value (MOVA value) are added to the "MOVA_predict" column in "protein/gene name_Target or Pathogenic_finalpredict.csv". "protein/gene name_Target or Pathogenic_result.csv" contains the Cutoff value (Youden index) for each fold (Column: Cutoff), the number of positive variants for each gene used in the analysis (Column: positive_variant_num), number of negative variants (Column: negative_variant_num), AUC for each fold of MOVA (Column: AUC), cvAUC for MOVA (Column: cvauc). The file required for redrawing with the MOVA_redraw function of MOVA is output in "protein/gene name_Target or Pathogenic_predict_orig.csv".
<!-- %%  ~~ If necessary, more details than the description above ~~ --></p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A data.frame containing the Cutoff value (Youden index) for each fold (Column: Cutoff), the number of positive variants for each gene used in the analysis (Column: positive_variant_num), number of negative variants (Column: negative_variant_num), AUC for each fold of MOVA (Column: AUC), cvAUC for MOVA (Column: cvauc).
The same data is output to "protein/gene name_Target or Pathogenic_result.csv".
<!-- %%  ~Describe the value returned --></p>


<p><!-- %%  If it is a LIST, use --></p>


<p><!-- %%  \item{comp1 }{Description of 'comp1'} --></p>


<p><!-- %%  \item{comp2 }{Description of 'comp2'} --></p>


<p><!-- %% ... --></p>


    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p><!-- %% ~put references to the literature/web site here ~ --></p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Yuya Hatano
<!-- %%  ~~who you are~~ --></p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p><!-- %%  ~~further notes~~ --></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><!-- %% ~~objects to See Also as \code{\link{help}}, ~~~ --></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="Hgmd_divide.html">Hgmd_divide</a></span><span class="op">(</span><span class="st">"./source/TARDBP.csv"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="Edit_gnomAD_file.html">Edit_gnomAD_file</a></span><span class="op">(</span><span class="st">"./source/gnomAD_v3.1.2_ENST00000240185_2023_02_14_13_23_48.csv"</span>, <span class="st">"./source/TARDBP_gnomAD.csv"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="Edit_variant_data.html">Edit_variant_data</a></span><span class="op">(</span><span class="st">"../CADD_REVEL/AlphScore_final.tsv"</span>, <span class="st">"./source/TARDBP.csv"</span>, <span class="st">"./source/TARDBP_gnomAD.csv"</span>, <span class="st">"Q13148"</span>, <span class="st">"TARDBP"</span>, <span class="st">"./source/TARDBPvariantdata.csv"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="Edit_polyphen_data.html">Edit_polyphen_data</a></span><span class="op">(</span><span class="st">"../dbNSFP/dbNSFP4.3a/dbNSFP4.3a_variant.chr1"</span>,<span class="st">"./source/TARDBPvariantdata.csv"</span>, <span class="st">"TARDBP_alph.csv"</span>,  <span class="st">"Q13148"</span>,  <span class="fl">11012654</span>, <span class="fl">11025492</span> ,<span class="st">"./source/TARDBPvariantdatapol.csv"</span>, <span class="st">"./source/TARDBP_alphpol.csv"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="Edit_final_variant_file.html">Edit_final_variant_file</a></span><span class="op">(</span><span class="st">"./source/TARDBP_alphpol.csv"</span>,<span class="st">"./source/TARDBP_alphpol2.csv"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">MOVA</span><span class="op">(</span><span class="st">"./source/Q13148.fa"</span>, <span class="st">"TARDBP"</span>, <span class="st">"./source/AF-Q13148-F1-model_v2.pdb"</span>,<span class="st">"./source/TARDBP_alphpol2.csv"</span>, <span class="st">"./source/TARDBPvariantdatapol.csv"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The function is currently defined as</span></span></span>
<span class="r-in"><span><span class="kw">function</span> <span class="op">(</span><span class="va">fasta_file_name</span>, <span class="va">protein_name</span>, <span class="va">pdb_file_name</span>, <span class="va">final_predict_input_file</span>, </span></span>
<span class="r-in"><span>    <span class="va">variant_file</span>, <span class="va">phenotype</span> <span class="op">=</span> <span class="st">"Target"</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"BLOSUM62"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">amino_code1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"R"</span>, <span class="st">"N"</span>, <span class="st">"D"</span>, <span class="st">"C"</span>, <span class="st">"Q"</span>, <span class="st">"E"</span>, <span class="st">"G"</span>, </span></span>
<span class="r-in"><span>        <span class="st">"I"</span>, <span class="st">"L"</span>, <span class="st">"K"</span>, <span class="st">"M"</span>, <span class="st">"F"</span>, <span class="st">"P"</span>, <span class="st">"S"</span>, <span class="st">"T"</span>, <span class="st">"W"</span>, <span class="st">"Y"</span>, <span class="st">"V"</span>, </span></span>
<span class="r-in"><span>        <span class="st">"H"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">Protein</span> <span class="op">&lt;-</span> <span class="fu">read.fasta</span><span class="op">(</span>file <span class="op">=</span> <span class="va">fasta_file_name</span>, seqtype <span class="op">=</span> <span class="st">"AA"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">Proteinr</span> <span class="op">&lt;-</span> <span class="va">Protein</span><span class="op">$</span><span class="va">Protein</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Protein</span><span class="op">$</span><span class="va">Protein</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="va">Protein3D</span> <span class="op">&lt;-</span> <span class="fu">read.pdb</span><span class="op">(</span><span class="va">pdb_file_name</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">Protein3Dr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Protein3D</span><span class="op">$</span><span class="va">atom</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">Protein3Dp</span> <span class="op">&lt;-</span> <span class="va">Protein3Dr</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">resno</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">summarise</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>        y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>, b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">b</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">D</span> <span class="op">&lt;-</span> <span class="fu">fread</span><span class="op">(</span><span class="va">variant_file</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">D</span><span class="op">$</span><span class="va">ID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">D</span><span class="op">$</span><span class="va">Chromosome</span>, <span class="va">D</span><span class="op">$</span><span class="va">Position</span>, <span class="va">D</span><span class="op">$</span><span class="va">Reference</span>, <span class="va">D</span><span class="op">$</span><span class="va">Alternate</span>, </span></span>
<span class="r-in"><span>        sep <span class="op">=</span> <span class="st">":"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">D</span> <span class="op">&lt;-</span> <span class="va">D</span><span class="op">[</span><span class="op">(</span><span class="va">D</span><span class="op">$</span><span class="va">possible</span> <span class="op">!=</span> <span class="st">"DMp"</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">D</span><span class="op">$</span><span class="va">possible</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">phenotype</span> <span class="op">==</span> <span class="st">"Target"</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">D</span> <span class="op">&lt;-</span> <span class="va">D</span><span class="op">[</span><span class="op">(</span><span class="va">D</span><span class="op">$</span><span class="va">Type</span> <span class="op">==</span> <span class="st">"Target"</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">D</span><span class="op">$</span><span class="va">Type</span> <span class="op">==</span> <span class="st">"Ctrl"</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="va">D</span><span class="op">[</span>, <span class="fu">`:=`</span><span class="op">(</span><span class="va">possible</span>, <span class="cn">NULL</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="va">D</span><span class="op">$</span><span class="va">Pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">D</span><span class="op">$</span><span class="va">change</span>, <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">D</span><span class="op">$</span><span class="va">change</span><span class="op">)</span> <span class="op">-</span> </span></span>
<span class="r-in"><span>        <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">D</span><span class="op">$</span><span class="va">ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">D</span><span class="op">$</span><span class="va">change</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">D</span><span class="op">$</span><span class="va">change</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">D</span><span class="op">$</span><span class="va">change</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">fpredict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">3</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>        <span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">fpredict</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"change"</span>, <span class="st">"predict"</span>, <span class="st">"n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">imp.rfa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">3</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>        <span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">imp.rfa</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"IncNodePurity"</span>, <span class="st">"n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">D</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">D</span><span class="op">$</span><span class="va">con</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">BLOSUM62</span><span class="op">[</span><span class="va">Proteinr</span><span class="op">[</span><span class="va">D</span><span class="op">$</span><span class="va">Pos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">Proteinr</span><span class="op">[</span><span class="va">D</span><span class="op">$</span><span class="va">Pos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> </span></span>
<span class="r-in"><span>            <span class="va">BLOSUM62</span><span class="op">[</span><span class="va">Proteinr</span><span class="op">[</span><span class="va">D</span><span class="op">$</span><span class="va">Pos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">D</span><span class="op">$</span><span class="va">ss</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>        <span class="va">D</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Protein3Dp</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="va">D</span><span class="op">$</span><span class="va">Pos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>        <span class="va">D</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Protein3Dp</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="va">D</span><span class="op">$</span><span class="va">Pos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>        <span class="va">D</span><span class="op">$</span><span class="va">z</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Protein3Dp</span><span class="op">$</span><span class="va">z</span><span class="op">[</span><span class="va">D</span><span class="op">$</span><span class="va">Pos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>        <span class="va">D</span><span class="op">$</span><span class="va">b</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Protein3Dp</span><span class="op">$</span><span class="va">b</span><span class="op">[</span><span class="va">D</span><span class="op">$</span><span class="va">Pos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="va">final_data</span> <span class="op">&lt;-</span> <span class="fu">fread</span><span class="op">(</span><span class="va">final_predict_input_file</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">final_data</span><span class="op">$</span><span class="va">ID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">final_data</span><span class="op">$</span><span class="va">Chromosome</span>, <span class="va">final_data</span><span class="op">$</span><span class="va">Position</span>, </span></span>
<span class="r-in"><span>        <span class="va">final_data</span><span class="op">$</span><span class="va">Reference</span>, <span class="va">final_data</span><span class="op">$</span><span class="va">Alternate</span>, <span class="va">final_data</span><span class="op">$</span><span class="va">aaref</span>, </span></span>
<span class="r-in"><span>        <span class="va">final_data</span><span class="op">$</span><span class="va">Pos</span>, <span class="va">final_data</span><span class="op">$</span><span class="va">aaalt</span>, sep <span class="op">=</span> <span class="st">":"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">final_data</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">final_data</span><span class="op">$</span><span class="va">con</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">BLOSUM62</span><span class="op">[</span><span class="va">Proteinr</span><span class="op">[</span><span class="va">final_data</span><span class="op">$</span><span class="va">Pos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, </span></span>
<span class="r-in"><span>            <span class="va">Proteinr</span><span class="op">[</span><span class="va">final_data</span><span class="op">$</span><span class="va">Pos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="va">BLOSUM62</span><span class="op">[</span><span class="va">Proteinr</span><span class="op">[</span><span class="va">final_data</span><span class="op">$</span><span class="va">Pos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, </span></span>
<span class="r-in"><span>            <span class="va">final_data</span><span class="op">$</span><span class="va">aaalt</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>        <span class="va">final_data</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Protein3Dp</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="va">final_data</span><span class="op">$</span><span class="va">Pos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>        <span class="va">final_data</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Protein3Dp</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="va">final_data</span><span class="op">$</span><span class="va">Pos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>        <span class="va">final_data</span><span class="op">$</span><span class="va">z</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Protein3Dp</span><span class="op">$</span><span class="va">z</span><span class="op">[</span><span class="va">final_data</span><span class="op">$</span><span class="va">Pos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>        <span class="va">final_data</span><span class="op">$</span><span class="va">b</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Protein3Dp</span><span class="op">$</span><span class="va">b</span><span class="op">[</span><span class="va">final_data</span><span class="op">$</span><span class="va">Pos</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">6</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>        <span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"result"</span>, <span class="st">"predict"</span>, <span class="st">"change"</span>, <span class="st">"iter1"</span>, </span></span>
<span class="r-in"><span>        <span class="st">"iter2"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">phenotype</span> <span class="op">==</span> <span class="st">"Target"</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">D</span><span class="op">$</span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">D</span><span class="op">$</span><span class="va">Type2</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">D</span><span class="op">$</span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">D</span><span class="op">$</span><span class="va">Type3</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="va">oldw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"warn"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>warn <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">D</span> <span class="op">&lt;-</span> <span class="fu">rowid_to_column</span><span class="op">(</span><span class="va">D</span>, var <span class="op">=</span> <span class="st">"id2"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i2</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">D</span><span class="op">$</span><span class="va">id3</span> <span class="op">&lt;-</span> <span class="va">D</span><span class="op">$</span><span class="va">id2</span></span></span>
<span class="r-in"><span>        <span class="va">j</span> <span class="op">&lt;-</span> <span class="fl">5</span></span></span>
<span class="r-in"><span>        <span class="va">dat1</span> <span class="op">&lt;-</span> <span class="va">D</span> <span class="op">%&gt;%</span> <span class="fu">stratified</span><span class="op">(</span><span class="va">.</span>, group <span class="op">=</span> <span class="st">"result"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">j</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="va">dat1</span><span class="op">$</span><span class="va">iter</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>        <span class="va">datzan</span> <span class="op">&lt;-</span> <span class="va">D</span><span class="op">[</span><span class="op">-</span><span class="va">dat1</span><span class="op">$</span><span class="va">id2</span>, <span class="op">]</span></span></span>
<span class="r-in"><span>        <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">j</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>            <span class="va">datzan</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id2"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span>            <span class="va">datzan</span> <span class="op">&lt;-</span> <span class="fu">rowid_to_column</span><span class="op">(</span><span class="va">datzan</span>, var <span class="op">=</span> <span class="st">"id2"</span><span class="op">)</span></span></span>
<span class="r-in"><span>            <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">!=</span> <span class="va">j</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>                <span class="va">dat2</span> <span class="op">&lt;-</span> <span class="va">datzan</span> <span class="op">%&gt;%</span> <span class="fu">stratified</span><span class="op">(</span><span class="va">.</span>, group <span class="op">=</span> <span class="st">"result"</span>, </span></span>
<span class="r-in"><span>                  size <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">j</span> <span class="op">-</span> <span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>            <span class="op">}</span></span></span>
<span class="r-in"><span>            <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>                <span class="va">dat2</span> <span class="op">&lt;-</span> <span class="va">datzan</span></span></span>
<span class="r-in"><span>            <span class="op">}</span></span></span>
<span class="r-in"><span>            <span class="va">dat2</span><span class="op">$</span><span class="va">iter</span> <span class="op">&lt;-</span> <span class="va">i</span></span></span>
<span class="r-in"><span>            <span class="va">datzan</span> <span class="op">&lt;-</span> <span class="va">datzan</span><span class="op">[</span><span class="op">-</span><span class="va">dat2</span><span class="op">$</span><span class="va">id2</span>, <span class="op">]</span></span></span>
<span class="r-in"><span>            <span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">dat1</span>, <span class="va">dat2</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="op">}</span></span></span>
<span class="r-in"><span>        <span class="va">dat1</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id2"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu">rowid_to_column</span><span class="op">(</span><span class="va">dat1</span>, var <span class="op">=</span> <span class="st">"id2"</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">j</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>            <span class="va">val</span> <span class="op">&lt;-</span> <span class="va">dat1</span><span class="op">[</span><span class="va">dat1</span><span class="op">$</span><span class="va">iter</span> <span class="op">==</span> <span class="va">i</span>, <span class="op">]</span></span></span>
<span class="r-in"><span>            <span class="va">train.data</span> <span class="op">&lt;-</span> <span class="va">dat1</span><span class="op">[</span><span class="op">-</span><span class="va">val</span><span class="op">$</span><span class="va">id2</span>, <span class="op">]</span></span></span>
<span class="r-in"><span>            <span class="va">rf</span> <span class="op">&lt;-</span> <span class="fu">randomForest</span><span class="op">(</span><span class="va">result</span> <span class="op">~</span> <span class="va">con</span> <span class="op">+</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> <span class="va">b</span>, </span></span>
<span class="r-in"><span>                <span class="va">train.data</span>, importance <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>            <span class="va">imp.rf</span> <span class="op">&lt;-</span> <span class="fu">importance</span><span class="op">(</span><span class="va">rf</span><span class="op">)</span></span></span>
<span class="r-in"><span>            <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="va">val</span><span class="op">$</span><span class="va">ID</span>, result <span class="op">=</span> <span class="va">val</span><span class="op">$</span><span class="va">result</span>, </span></span>
<span class="r-in"><span>                predict <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rf</span>, <span class="va">val</span><span class="op">)</span>, change <span class="op">=</span> <span class="va">val</span><span class="op">$</span><span class="va">change</span>, </span></span>
<span class="r-in"><span>                iter1 <span class="op">=</span> <span class="va">i</span>, iter2 <span class="op">=</span> <span class="va">i2</span><span class="op">)</span></span></span>
<span class="r-in"><span>            <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">f</span><span class="op">)</span></span></span>
<span class="r-in"><span>            <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">imp.rf</span><span class="op">)</span>, IncNodePurity <span class="op">=</span> <span class="va">imp.rf</span>, </span></span>
<span class="r-in"><span>                n <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span></span>
<span class="r-in"><span>            <span class="va">imp.rfa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">imp.rfa</span>, <span class="va">f</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">rf</span> <span class="op">&lt;-</span> <span class="fu">randomForest</span><span class="op">(</span><span class="va">result</span> <span class="op">~</span> <span class="va">con</span> <span class="op">+</span> <span class="va">x</span> <span class="op">+</span> <span class="va">y</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> <span class="va">b</span>, <span class="va">D</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="va">final_data</span><span class="op">$</span><span class="va">ID</span>, predict <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">rf</span>, </span></span>
<span class="r-in"><span>            <span class="va">final_data</span><span class="op">)</span>, n <span class="op">=</span> <span class="va">i</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="va">fpredict</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">fpredict</span>, <span class="va">f</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>warn <span class="op">=</span> <span class="va">oldw</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">fpredictb</span> <span class="op">&lt;-</span> <span class="va">fpredict</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">ID</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">summarise</span><span class="op">(</span>MOVA_predict <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">predict</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">imp.rfb</span> <span class="op">&lt;-</span> <span class="va">imp.rfa</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">summarise</span><span class="op">(</span>IncMSE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">IncNodePurity..IncMSE</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>        IncNodePurity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">IncNodePurity.IncNodePurity</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">ID</span> <span class="op">&lt;-</span> <span class="fu">str_split</span><span class="op">(</span><span class="va">fpredictb</span><span class="op">$</span><span class="va">ID</span>, pattern <span class="op">=</span> <span class="st">":"</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">fpredictb</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="kw">if</span> <span class="op">(</span><span class="va">ID</span><span class="op">[</span><span class="va">i</span>, <span class="fl">5</span><span class="op">]</span> <span class="op">==</span> <span class="va">ID</span><span class="op">[</span><span class="va">i</span>, <span class="fl">7</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>            <span class="va">fpredictb</span><span class="op">$</span><span class="va">predict</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0</span></span></span>
<span class="r-in"><span>        <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="va">final_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">fpredictb</span>, <span class="va">final_data</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu">fwrite</span><span class="op">(</span><span class="va">final_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">protein_name</span>, <span class="va">phenotype</span>, <span class="st">"finalpredict.csv"</span>, </span></span>
<span class="r-in"><span>        sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu">fwrite</span><span class="op">(</span><span class="va">imp.rfb</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">protein_name</span>, <span class="va">phenotype</span>, <span class="st">"importance.csv"</span>, </span></span>
<span class="r-in"><span>        sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">df</span><span class="op">$</span><span class="va">iter3</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">$</span><span class="va">iter1</span> <span class="op">+</span> <span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">iter2</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">cvAUC</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">predict</span>, <span class="va">df</span><span class="op">$</span><span class="va">result</span>, label.ordering <span class="op">=</span> <span class="cn">NULL</span>, </span></span>
<span class="r-in"><span>        folds <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">iter3</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">$</span><span class="va">perf</span>, col <span class="op">=</span> <span class="st">"red"</span>, avg <span class="op">=</span> <span class="st">"vertical"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">cvauc</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">$</span><span class="va">cvAUC</span></span></span>
<span class="r-in"><span>    <span class="va">YI2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">5</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>        <span class="op">]</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">YI2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cutoff"</span>, <span class="st">"positive_variant_num"</span>, <span class="st">"negative_variant_num"</span>, </span></span>
<span class="r-in"><span>        <span class="st">"AUC"</span>, <span class="st">"cvauc"</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">6</span><span class="op">:</span><span class="fl">30</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>        <span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu">prediction</span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">iter3</span> <span class="op">==</span> <span class="va">i</span>, <span class="op">]</span><span class="op">$</span><span class="va">predict</span>, <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">iter3</span> <span class="op">==</span> </span></span>
<span class="r-in"><span>            <span class="va">i</span>, <span class="op">]</span><span class="op">$</span><span class="va">result</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="va">auc.tmp</span> <span class="op">&lt;-</span> <span class="fu">performance</span><span class="op">(</span><span class="va">pred</span>, <span class="st">"auc"</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="va">auc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">auc.tmp</span><span class="op">@</span><span class="va">y.values</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Cutoff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">pred</span><span class="op">@</span><span class="va">cutoffs</span><span class="op">)</span>, TP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">pred</span><span class="op">@</span><span class="va">tp</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>            FP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">pred</span><span class="op">@</span><span class="va">fp</span><span class="op">)</span>, FN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">pred</span><span class="op">@</span><span class="va">fn</span><span class="op">)</span>, TN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">pred</span><span class="op">@</span><span class="va">tn</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>            Sensitivity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">pred</span><span class="op">@</span><span class="va">tp</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">pred</span><span class="op">@</span><span class="va">tp</span><span class="op">)</span> <span class="op">+</span> </span></span>
<span class="r-in"><span>                <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">pred</span><span class="op">@</span><span class="va">fn</span><span class="op">)</span><span class="op">)</span>, Specificity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">pred</span><span class="op">@</span><span class="va">tn</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">pred</span><span class="op">@</span><span class="va">fp</span><span class="op">)</span> <span class="op">+</span> </span></span>
<span class="r-in"><span>                <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">pred</span><span class="op">@</span><span class="va">tn</span><span class="op">)</span><span class="op">)</span>, Accuracy <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">pred</span><span class="op">@</span><span class="va">tp</span><span class="op">)</span> <span class="op">+</span> </span></span>
<span class="r-in"><span>                <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">pred</span><span class="op">@</span><span class="va">tn</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span>, Precision <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">pred</span><span class="op">@</span><span class="va">tp</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">pred</span><span class="op">@</span><span class="va">tp</span><span class="op">)</span> <span class="op">+</span> </span></span>
<span class="r-in"><span>                <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">pred</span><span class="op">@</span><span class="va">fp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="va">tab</span><span class="op">$</span><span class="va">Youden</span> <span class="op">&lt;-</span> <span class="va">tab</span><span class="op">$</span><span class="va">Sensitivity</span> <span class="op">+</span> <span class="va">tab</span><span class="op">$</span><span class="va">Specificity</span> <span class="op">-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>        <span class="va">YI</span> <span class="op">&lt;-</span> <span class="va">tab</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">tab</span><span class="op">$</span><span class="va">Youden</span>, decreasing <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span>        <span class="va">YI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Cutoff <span class="op">=</span> <span class="va">YI</span><span class="op">$</span><span class="va">Cutoff</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, positive_variant_num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">result</span> <span class="op">==</span> </span></span>
<span class="r-in"><span>            <span class="fl">1</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">iter2</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span>, negative_variant_num <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">result</span> <span class="op">==</span> </span></span>
<span class="r-in"><span>            <span class="fl">0</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">iter2</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span>, AUC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">auc</span><span class="op">)</span>, cvauc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cvauc</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>        <span class="va">YI2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">YI2</span>, <span class="va">YI</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>    <span class="fu">fwrite</span><span class="op">(</span><span class="va">YI2</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">protein_name</span>, <span class="va">phenotype</span>, <span class="st">"result.csv"</span>, </span></span>
<span class="r-in"><span>        sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">df2</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">ID</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">summarise</span><span class="op">(</span>MOVA_predict <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">predict</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">D</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"result"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu">fwrite</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">D</span>, <span class="va">df2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">protein_name</span>, <span class="va">phenotype</span>, <span class="st">"predict.csv"</span>, </span></span>
<span class="r-in"><span>        sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu">fwrite</span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">protein_name</span>, <span class="va">phenotype</span>, <span class="st">"predict_orig.csv"</span>, </span></span>
<span class="r-in"><span>        sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">YI2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (fasta_file_name, protein_name, pdb_file_name, final_predict_input_file, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     variant_file, phenotype = "Target") </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     data("BLOSUM62")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     amino_code1 &lt;- c("A", "R", "N", "D", "C", "Q", "E", "G", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "I", "L", "K", "M", "F", "P", "S", "T", "W", "Y", "V", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "H")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Protein &lt;- read.fasta(file = fasta_file_name, seqtype = "AA")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Proteinr &lt;- Protein$Protein[1:length(Protein$Protein)]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Protein3D &lt;- read.pdb(pdb_file_name)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Protein3Dr &lt;- as.data.frame(Protein3D$atom)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Protein3Dp &lt;- Protein3Dr %&gt;% group_by(resno) %&gt;% summarise(x = mean(x), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         y = mean(y), z = mean(z), b = mean(b))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     D &lt;- fread(variant_file)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     D$ID &lt;- paste(D$Chromosome, D$Position, D$Reference, D$Alternate, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         sep = ":")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     D &lt;- D[(D$possible != "DMp") | (is.na(D$possible)), ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (phenotype == "Target") {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         D &lt;- D[(D$Type == "Target") | (D$Type == "Ctrl"), ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     D[, `:=`(possible, NULL)]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     D$Pos &lt;- as.integer(substr(D$change, 2, nchar(D$change) - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         1))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     D$ss &lt;- substr(D$change, nchar(D$change), nchar(D$change))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     fpredict &lt;- data.frame(matrix(rep(NA, 3), nrow = 1))[numeric(0), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     colnames(fpredict) &lt;- c("change", "predict", "n")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     imp.rfa &lt;- data.frame(matrix(rep(NA, 3), nrow = 1))[numeric(0), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     colnames(imp.rfa) &lt;- c("name", "IncNodePurity", "n")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     for (i in 1:nrow(D)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         D$con[i] &lt;- BLOSUM62[Proteinr[D$Pos[i]], Proteinr[D$Pos[i]]] - </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             BLOSUM62[Proteinr[D$Pos[i]], D$ss[i]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         D$x[i] &lt;- Protein3Dp$x[D$Pos[i]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         D$y[i] &lt;- Protein3Dp$y[D$Pos[i]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         D$z[i] &lt;- Protein3Dp$z[D$Pos[i]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         D$b[i] &lt;- Protein3Dp$b[D$Pos[i]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     final_data &lt;- fread(final_predict_input_file)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     final_data$ID &lt;- paste(final_data$Chromosome, final_data$Position, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         final_data$Reference, final_data$Alternate, final_data$aaref, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         final_data$Pos, final_data$aaalt, sep = ":")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     for (i in 1:nrow(final_data)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         final_data$con[i] &lt;- BLOSUM62[Proteinr[final_data$Pos[i]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Proteinr[final_data$Pos[i]]] - BLOSUM62[Proteinr[final_data$Pos[i]], </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             final_data$aaalt[i]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         final_data$x[i] &lt;- Protein3Dp$x[final_data$Pos[i]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         final_data$y[i] &lt;- Protein3Dp$y[final_data$Pos[i]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         final_data$z[i] &lt;- Protein3Dp$z[final_data$Pos[i]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         final_data$b[i] &lt;- Protein3Dp$b[final_data$Pos[i]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     df &lt;- data.frame(matrix(rep(NA, 6), nrow = 1))[numeric(0), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     colnames(df) &lt;- c("ID", "result", "predict", "change", "iter1", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "iter2")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (phenotype == "Target") {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         D$result &lt;- D$Type2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         D$result &lt;- D$Type3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     oldw &lt;- getOption("warn")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     options(warn = -1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     D &lt;- rowid_to_column(D, var = "id2")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     for (i2 in 1:5) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         D$id3 &lt;- D$id2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         j &lt;- 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         dat1 &lt;- D %&gt;% stratified(., group = "result", size = 1/j)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         dat1$iter &lt;- 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         datzan &lt;- D[-dat1$id2, ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         for (i in 2:j) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             datzan[, c("id2")] &lt;- list(NULL)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             datzan &lt;- rowid_to_column(datzan, var = "id2")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (i != j) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 dat2 &lt;- datzan %&gt;% stratified(., group = "result", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   size = 1/(j - i + 1))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 dat2 &lt;- datzan</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             dat2$iter &lt;- i</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             datzan &lt;- datzan[-dat2$id2, ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             dat1 &lt;- rbind(dat1, dat2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         dat1[, c("id2")] &lt;- list(NULL)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         dat1 &lt;- rowid_to_column(dat1, var = "id2")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         for (i in 1:j) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             val &lt;- dat1[dat1$iter == i, ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             train.data &lt;- dat1[-val$id2, ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             rf &lt;- randomForest(result ~ con + x + y + z + b, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 train.data, importance = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             imp.rf &lt;- importance(rf)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             f &lt;- data.frame(ID = val$ID, result = val$result, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 predict = predict(rf, val), change = val$change, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 iter1 = i, iter2 = i2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             df &lt;- rbind(df, f)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             f &lt;- data.frame(name = rownames(imp.rf), IncNodePurity = imp.rf, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 n = i)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             imp.rfa &lt;- rbind(imp.rfa, f)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     for (i in 1:30) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         rf &lt;- randomForest(result ~ con + x + y + z + b, D)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         f &lt;- data.frame(ID = final_data$ID, predict = predict(rf, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             final_data), n = i)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         fpredict &lt;- rbind(fpredict, f)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     options(warn = oldw)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     fpredictb &lt;- fpredict %&gt;% group_by(ID) %&gt;% summarise(MOVA_predict = mean(predict))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     imp.rfb &lt;- imp.rfa %&gt;% group_by(name) %&gt;% summarise(IncMSE = mean(IncNodePurity..IncMSE), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         IncNodePurity = mean(IncNodePurity.IncNodePurity))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ID &lt;- str_split(fpredictb$ID, pattern = ":", simplify = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     for (i in 1:nrow(fpredictb)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (ID[i, 5] == ID[i, 7]) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             fpredictb$predict[i] = 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     final_data &lt;- merge(fpredictb, final_data)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     fwrite(final_data, paste(protein_name, phenotype, "finalpredict.csv", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         sep = "_"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     fwrite(imp.rfb, paste(protein_name, phenotype, "importance.csv", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         sep = "_"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     df$iter3 &lt;- df$iter1 + (df$iter2 * 5)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     out &lt;- cvAUC(df$predict, df$result, label.ordering = NULL, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         folds = df$iter3)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     plot(out$perf, col = "red", avg = "vertical")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     cvauc &lt;- out$cvAUC</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     YI2 &lt;- data.frame(matrix(rep(NA, 5), nrow = 1))[numeric(0), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     colnames(YI2) &lt;- c("Cutoff", "positive_variant_num", "negative_variant_num", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         "AUC", "cvauc")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     for (i in 6:30) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         pred &lt;- prediction(df[df$iter3 == i, ]$predict, df[df$iter3 == </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             i, ]$result)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         auc.tmp &lt;- performance(pred, "auc")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         auc &lt;- as.numeric(auc.tmp@y.values)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         tab &lt;- data.frame(Cutoff = unlist(pred@cutoffs), TP = unlist(pred@tp), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             FP = unlist(pred@fp), FN = unlist(pred@fn), TN = unlist(pred@tn), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Sensitivity = unlist(pred@tp)/(unlist(pred@tp) + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 unlist(pred@fn)), Specificity = unlist(pred@tn)/(unlist(pred@fp) + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 unlist(pred@tn)), Accuracy = ((unlist(pred@tp) + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 unlist(pred@tn))/nrow(df)), Precision = (unlist(pred@tp)/(unlist(pred@tp) + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 unlist(pred@fp))))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         tab$Youden &lt;- tab$Sensitivity + tab$Specificity - 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         YI &lt;- tab[order(tab$Youden, decreasing = T), ]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         YI &lt;- data.frame(Cutoff = YI$Cutoff[1], positive_variant_num = c(nrow(df[(df$result == </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             1) &amp; (df$iter2 == 1), ])), negative_variant_num = c(nrow(df[(df$result == </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             0) &amp; (df$iter2 == 1), ])), AUC = c(auc), cvauc = c(cvauc))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         YI2 &lt;- rbind(YI2, YI)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     fwrite(YI2, paste(protein_name, phenotype, "result.csv", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         sep = "_"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     df2 &lt;- df %&gt;% group_by(ID) %&gt;% summarise(MOVA_predict = mean(predict))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     D[, c("result")] &lt;- list(NULL)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     fwrite(merge(D, df2), paste(protein_name, phenotype, "predict.csv", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         sep = "_"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     fwrite(df, paste(protein_name, phenotype, "predict_orig.csv", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         sep = "_"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     return(YI2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x0000011a8918dcf0&gt;</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Yuya Hatano.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

